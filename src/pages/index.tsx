import type { NextPage } from 'next'
import Head from 'next/head'
import { useRouter } from "next/router";
import DefaultLayout from "../app/UI/Layout/Default";
import LoginForm from 'src/app/UI/Home/LoginForm/LoginForm';
import { useEffect, useState } from 'react';
import { css } from "@emotion/css";
import axios from "axios";
import ApiUtils from "src/app/Game/Utils/ApiUtils";
import NetworkManager from "src/app/Game/Managers/NetworkManager";

interface credentials {
    usernameOrEmail: string;
    password: string; 
}

const Home: NextPage = () => {
    const router = useRouter(),
        [loginInfo, setLoginInfo] = useState({ username: "", email: "", password: "" }),
        [credentials, setCredentials] = useState({ usernameOrEmail: "", password: "" } as credentials),
        handlers = {
            async onLoginFormSubmit(e: Event) {
                e.preventDefault();
                console.log(credentials);
                try {
                    const res = await axios.post(ApiUtils.url("/user/login"), { 
                        usernameOrEmail: credentials.usernameOrEmail,
                        password: credentials.password
                    }),
                        networkManager = new NetworkManager();

                    networkManager.auth.storeToken(res.data.token);
                    router.push("/thoughts");
                } catch (e) {
                    console.log("wrong");
                    console.log(e);
                }   
            }
        },
        styles = {
            main: css`
                padding-bottom : 100px;

                header {
                    text-align  : center;
                    margin-top  : 100px;

                    h1 {
                        text-shadow : 0px 0px 23px #B45D5D;
                    }

                    p {
                        font-size : 20px;
                    }
                }
            `
        }

    return (
        <DefaultLayout>
            <Head>
                <title>ThoughtApp | See what others are thinking</title>
                <meta 
                    name="description" 
                    content="Generated by create next app" />
                <link 
                    rel="icon" 
                    href="/favicon.ico" />
            </Head>
            <div
                className={styles.main} 
                id="home">
                <header>
                    <div className="container">
                        <h1>ThoughtApp</h1>
                        <p>See what others are thinking</p>
                    </div>
                </header>
                <main>
                    <div className="container">
                        <LoginForm 
                            {...credentials}
                            onSubmit={(e: Event) => handlers.onLoginFormSubmit(e)}
                            onChange={(data: credentials) => setCredentials({ usernameOrEmail: data.usernameOrEmail, password: data.password })} />
                    </div>
                </main>
            </div>
        </DefaultLayout>
    );
}

export default Home
